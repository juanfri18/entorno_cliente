<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Segunda Mano</title>
</head>
<body>
    <script>
        // 1. ARRAY PRODUCTOS
        let productos = [
            { id: 1, titulo: "Bicicleta montaña", precio: 100, categoria: "deportes", fechaPublicacion: new Date("2024-01-10") },
            { id: 2, titulo: "Sofá cama", precio: 250, categoria: "hogar", fechaPublicacion: new Date("2024-02-15") },
            { id: 3, titulo: "Raqueta tenis", precio: 30, categoria: "deportes", fechaPublicacion: new Date("2024-03-01") },
            { id: 4, titulo: "Lámpara vintage", precio: 45, categoria: "hogar", fechaPublicacion: new Date("2024-03-05") }
        ];

        // 2. FILTRAR POR CATEGORÍA
        function filtrarPorCategoria(cat) {
            // Devuelve nuevo array solo con esa categoría
            return productos.filter(p => p.categoria === cat);
        }

        // 3. BUSCAR PRODUCTO (Título contiene palabra)
        function buscarProducto(palabra) {
            let busqueda = palabra.toLowerCase();
            return productos.filter(p => p.titulo.toLowerCase().includes(busqueda));
        }

        // 4. MAP DE VENTAS (ID -> Cantidad)
        let ventas = new Map();

        // 5. REGISTRAR VENTA
        function registrarVenta(id) {
            // Buscamos si el producto existe en el array original (opcional pero recomendable)
            let existe = productos.some(p => p.id === id);
            
            if (existe) {
                // Si ya estaba en el mapa, sumamos 1. Si no, empezamos en 1.
                let cantidadActual = ventas.get(id) || 0;
                ventas.set(id, cantidadActual + 1);
                console.log(`Venta registrada del ID ${id}. Total vendidas: ${cantidadActual + 1}`);
            } else {
                console.error("Ese ID de producto no existe.");
            }
        }

        // 6. GUARDAR EN SESSION STORAGE (Solo mientras pestaña abierta)
        // Guardamos Array
        sessionStorage.setItem("productos_segundamano", JSON.stringify(productos));
        
        // Guardamos Mapa (Recuerda el truco Array.from)
        sessionStorage.setItem("ventas_sesion", JSON.stringify(Array.from(ventas)));
        console.log("Datos guardados en SessionStorage");

        // 7. COOKIE "usuarioCompras"
        function guardarUsuarioCookie(nombre) {
            let valor = nombre.toLowerCase(); // Requisito: Minúsculas
            let fecha = new Date();
            fecha.setTime(fecha.getTime() + (1 * 24 * 60 * 60 * 1000)); // +1 día
            
            document.cookie = `usuarioCompras=${valor}; expires=${fecha.toUTCString()}; path=/`;
        }

        // PRUEBAS
        console.log("Deportes:", filtrarPorCategoria("deportes"));
        console.log("Buscar 'cama':", buscarProducto("cama"));
        registrarVenta(1); // Vendemos una bici
        registrarVenta(1); // Vendemos otra bici
        guardarUsuarioCookie("JUANFRI"); // Se guardará como 'juanfri'

    </script>
</body>
</html>